---
allowed-tools: Bash(doom:*), Bash(git:*), Read, TodoWrite
description: Sync Doom Emacs configuration and validate changes
---

# üîÑ DOOM SYNC: Configuration Synchronization

Sync Doom Emacs configuration changes with comprehensive validation and error checking.

## Pre-Sync Checks:

### 1. **Backup Current Configuration**
```bash
# Create backup of current configuration
cp -r ~/.config/doom ~/.config/doom.backup.$(date +%Y%m%d-%H%M%S)
```

### 2. **Git Status Check** 
```bash
# Check for uncommitted changes
git status --short

# Show recent changes
git diff --name-only HEAD~1..HEAD
```

### 3. **Configuration Validation**
```bash
# Check for basic syntax errors in Elisp files
emacs -Q --batch --eval "(checkdoc-file \"init.el\")" 2>&1 || echo "No major syntax errors in init.el"
emacs -Q --batch --eval "(checkdoc-file \"config.el\")" 2>&1 || echo "No major syntax errors in config.el" 
emacs -Q --batch --eval "(checkdoc-file \"packages.el\")" 2>&1 || echo "No major syntax errors in packages.el"
```

## Doom Sync Process:

### 4. **Run Doom Sync**
```bash
# Execute doom sync with verbose output
~/.emacs.d/bin/doom sync -v
```

### 5. **Check Sync Results**
```bash
# Capture sync output and check for errors
SYNC_OUTPUT=$(~/.emacs.d/bin/doom sync -v 2>&1)
echo "$SYNC_OUTPUT"

# Check for common error patterns
if echo "$SYNC_OUTPUT" | grep -i "error\|failed\|warning" > /dev/null; then
    echo "‚ö†Ô∏è Sync completed with warnings or errors. Review output above."
else
    echo "‚úÖ Sync completed successfully!"
fi
```

## Post-Sync Validation:

### 6. **Doctor Check**
```bash
# Run doom doctor to check for issues
~/.emacs.d/bin/doom doctor
```

### 7. **Package Verification**
```bash
# List installed packages
~/.emacs.d/bin/doom info | grep -A 20 "PACKAGES"

# Check for broken packages
~/.emacs.d/bin/doom info | grep -i "error\|broken\|missing"
```

### 8. **Quick Startup Test**
```bash
# Test configuration loading
timeout 30s emacs --batch --eval "(message \"Configuration loads successfully\")" 2>&1 || echo "‚ö†Ô∏è Configuration may have issues"
```

## Performance Baseline:

### 9. **Startup Time Measurement**
```bash
# Measure startup time (5 iterations for average)
echo "üìä Measuring startup performance..."
for i in {1..5}; do
    /usr/bin/time -f "%e seconds" emacs --eval "(kill-emacs)" 2>&1 | grep "seconds"
done

# Quick startup time check
emacs --eval "(message \"Startup time: %f seconds\" (float-time (time-subtract (current-time) before-init-time)))(kill-emacs)" 2>&1 | grep "Startup time"
```

## Generate Sync Report:

Create comprehensive sync report:

```markdown
# üîÑ Doom Sync Report

**Date**: $(date)
**Configuration**: $DOOM_CONFIG_DIR

## Sync Summary
- **Status**: [‚úÖ Success | ‚ö†Ô∏è Warnings | ‚ùå Errors]
- **Packages Updated**: [X packages]
- **Configuration Changes**: [Y files modified]
- **Sync Duration**: [Z seconds]

## Validation Results
- **Syntax Check**: [‚úÖ Pass | ‚ùå Fail]
- **Doctor Check**: [‚úÖ Pass | ‚ùå Issues Found]  
- **Package Integrity**: [‚úÖ Pass | ‚ùå Broken Packages]
- **Startup Test**: [‚úÖ Pass | ‚ùå Fail]

## Performance Impact
- **Current Startup Time**: [X.X seconds]
- **Previous Startup Time**: [Y.Y seconds] 
- **Performance Change**: [+/- Z.Z seconds]

## Issues Detected
[List any errors, warnings, or issues found during sync]

## Package Changes
[List packages added, updated, or removed]

## Recommendations
[Any recommendations for optimization or issue resolution]

## Next Steps
[Suggested actions based on sync results]

---
*Generated by doom-sync command*
```

## Error Handling:

### If Sync Fails:
1. **Restore Backup**:
   ```bash
   # Restore from backup if sync fails
   rm -rf ~/.config/doom && mv ~/.config/doom.backup.* ~/.config/doom
   ```

2. **Provide Debug Information**:
   - Show detailed error messages
   - Suggest common troubleshooting steps
   - Recommend checking Doom documentation

### If Doctor Reports Issues:
1. **Categorize Issues**:
   - Critical (must fix)
   - Warnings (should fix)
   - Info (nice to fix)

2. **Provide Fix Suggestions**:
   - Link to relevant documentation
   - Suggest specific commands to run
   - Identify configuration conflicts

## Status Updates:

Update TodoWrite with:
- [ ] Configuration backed up
- [ ] Doom sync completed
- [ ] Doctor check passed
- [ ] Performance verified
- [ ] Issues resolved (if any)

## Summary Output:

```
üîÑ Doom Sync Complete:
‚Ä¢ Status: [Success/Warning/Error]
‚Ä¢ Packages: [X updated, Y added, Z removed]
‚Ä¢ Startup Time: [X.X seconds (¬±Y.Y from baseline)]
‚Ä¢ Issues: [None/X warnings/Y errors]
‚Ä¢ Next Action: [Continue development/Fix issues/Run tests]
```

## Integration:

This command integrates with:
- Git workflow (pre/post commit hooks)
- Configuration testing workflow
- Performance monitoring
- Issue tracking for configuration problems